{% extends "dashboard/base.html" %}
{# Inherits the common dashboard layout (top bar, sidebar, main content area) #}

{% load static %}
{# Loads static files such as CSS #}

{% block title %}Change Password{% endblock %}
{# Sets the browser/page title dynamically #}

{% block css %}
{# Page-specific CSS for password change styling #}
<link rel="stylesheet" href="{% static 'css/password.css' %}">
{% endblock %}

{% block top_actions %}
{# Top-right action area in dashboard header #}

<form method="POST" action="{% url 'logout' %}" style="display:inline;">
    {# Logout form using POST for security #}
    {% csrf_token %}
    {# CSRF token for protection #}
    <button type="submit" class="btn-outline">Logout</button>
</form>
{% endblock %}

{% block content %}
{# Main content section for change password page #}

<h2 class="page-title">Change Password</h2>
{# Page heading #}

{# ================= ERROR HANDLING ================= #}
{% if form.errors %}
<div class="error-box">
    {# Displays field-specific validation errors #}
    {% for field in form %}
        {% for error in field.errors %}
            <p class="error-text">{{ error }}</p>
        {% endfor %}
    {% endfor %}

    {# Displays non-field errors (e.g. incorrect old password) #}
    {% for error in form.non_field_errors %}
        <p class="error-text">{{ error }}</p>
    {% endfor %}
</div>
{% endif %}

<div class="password-card">
    {# Card container for password change form #}

    <form method="POST">
        {# Uses POST method to securely update password #}

        {% csrf_token %}
        {# CSRF token for protection against cross-site request forgery #}

        <div class="form-group">
            <label>Old Password</label>
            {# Field provided by Django PasswordChangeForm #}
            {{ form.old_password }}
        </div>

        <div class="form-group">
            <label>New Password</label>
            {# New password input with Django validation rules #}
            {{ form.new_password1 }}
        </div>

        <div class="form-group">
            <label>Confirm New Password</label>
            {# Confirmation field to ensure password match #}
            {{ form.new_password2 }}
        </div>

        {# Submit button to update password #}
        <button type="submit" class="btn-primary">
            Update Password
        </button>
    </form>
</div>

{% endblock %}
